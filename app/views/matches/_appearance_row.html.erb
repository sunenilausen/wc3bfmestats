<tr class="<%= appearance.is_early_leaver? ? 'bg-orange-50' : '' %>">
  <td class="px-2 py-1 font-medium whitespace-nowrap">
    <% if appearance.faction %>
      <span style="display: inline-block; width: 14px; height: 14px; background-color: <%= appearance.faction.color %>; border-radius: 3px; margin-right: 6px; vertical-align: middle;"></span>
    <% end %>
    <% if appearance.player %>
      <%= link_to appearance.player.nickname, player_path(appearance.player) %><% if appearance.player.alternative_name.present? %> <span class="text-gray-400 font-normal">(<%= appearance.player.alternative_name %>)</span><% end %>
      <% if appearance.is_early_leaver? %>
        <span class="ml-1 px-1.5 py-0.5 bg-orange-200 text-orange-800 text-xs rounded" title="Left within first 3 minutes">EARLY</span>
      <% end %>
    <% else %>
      <span class="text-gray-400">Unknown</span>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.stay_pct %>
      <% is_low_stay = appearance.stay_pct < 90 %>
      <% is_real_leave = is_low_stay && !is_excused_leave?(appearance, appearance.match) %>
      <span class="<%= is_real_leave ? 'text-red-600' : (is_low_stay ? 'text-yellow-600' : 'text-green-600') %>">
        <%= appearance.stay_pct.round %>%
      </span>
      <% if is_real_leave %>
        <span class="text-red-600 text-xs font-medium" title="Early leave (first to leave, no teammate followed within 60s)">LEAVE</span>
      <% elsif is_low_stay %>
        <span class="text-yellow-600 text-xs" title="Left early but excused (not first to leave or teammate followed)">left</span>
      <% end %>
    <% else %>
      <span class="text-gray-400">-</span>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.apm || '-' %>
  </td>
  <td class="px-2 py-1">
    <%= previous_record_for_appearance(appearance) %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.overall_avg_rank %>
      <span class="<%= appearance.overall_avg_rank <= 2.5 ? 'text-green-600' : (appearance.overall_avg_rank >= 3.5 ? 'text-red-600' : '') %>">
        <%= appearance.overall_avg_rank.round(1) %></span><% if appearance.faction_avg_rank %><span class="text-gray-400">/<%= appearance.faction_avg_rank.round(1) %></span><% end %>
    <% else %>
      <span class="text-gray-400">-</span>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.perf_score %>
      <span class="<%= appearance.perf_score >= 5 ? 'text-green-600' : (appearance.perf_score <= -5 ? 'text-red-600' : '') %>">
        <%= format_perf_score(appearance.perf_score.round) %></span><% if appearance.faction_perf_score %><span class="text-gray-400">/<%= format_perf_score(appearance.faction_perf_score.round) %></span><% end %>
    <% else %>
      <span class="text-gray-400">-</span>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.unit_kills %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.hero_kills %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.castles_razed || "-" %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.main_base_destroyed || 0 %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.heroes_lost && appearance.heroes_total %>
      <%= appearance.heroes_lost %>/<%= appearance.heroes_total %>
    <% else %>
      <%= heroes_lost_for_appearance(appearance) || "-" %>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <% uptime = calculate_hero_uptime_for_appearance(appearance, appearance.match) %>
    <% if uptime %>
      <span class="<%= uptime >= 80 ? 'text-green-600' : (uptime >= 60 ? 'text-yellow-600' : 'text-red-600') %>">
        <%= uptime.round %>%
      </span>
    <% else %>
      -
    <% end %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.bases_lost && appearance.bases_total %>
      <%= appearance.bases_lost %>/<%= appearance.bases_total %>
    <% else %>
      <%= bases_lost_for_appearance(appearance) || "-" %>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.team_heal || "-" %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.total_heal || "-" %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.contribution_rank.nil? %>
      <span class="text-gray-400">-</span>
    <% else %>
      <span class="text-gray-500">#<%= appearance.contribution_rank %></span>
      <span class="<%= appearance.contribution_bonus.to_i > 0 ? 'text-green-600' : (appearance.contribution_bonus.to_i < 0 ? 'text-red-600' : 'text-gray-400') %>">
        <%= appearance.contribution_bonus.to_i >= 0 ? '+' : '' %><%= appearance.contribution_bonus.to_i %>
      </span>
      <% if appearance.is_mvp? %>
        <span class="text-yellow-500" title="MVP: Top unit kills and hero kills">â˜…</span>
      <% end %>
    <% end %>
  </td>
  <td class="px-2 py-1">
    <%= appearance.custom_rating&.round %>
  </td>
  <td class="px-2 py-1">
    <% if appearance.custom_rating_change %>
      <span class="<%= appearance.custom_rating_change >= 0 ? 'text-green-600' : 'text-red-600' %>">
        <%= appearance.custom_rating_change >= 0 ? '+' : '' %><%= appearance.custom_rating_change.round %>
      </span>
    <% end %>
  </td>
</tr>
