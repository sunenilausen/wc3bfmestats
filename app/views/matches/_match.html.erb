<div id="<%= dom_id match %>" class="w-full my-5">
  <div>
    <strong class="inline font-medium">Played:</strong>
    <%= match.played_at&.strftime("%Y-%m-%d") || match.created_at.strftime("%Y-%m-%d") %>
    <% if match.seconds.present? && match.seconds > 0 %>
      <span class="text-gray-500">(<%= ChronicDuration.output(match.seconds, format: :short) %>)</span>
    <% end %>
    <% if match.ignored? %>
      <span class="ml-2 px-2 py-0.5 bg-red-100 text-red-700 text-sm rounded">Ignored</span>
    <% end %>
  </div>

  <div class="flex flex-col md:flex-row gap-6 mt-4">
    <div class="md:w-2/3">
      <strong class="block font-medium mb-1">Appearances:</strong>
      <ul class="list-disc pl-5">
        <li class="font-semibold mb-2">Forces of Middle Earth (<%= match.good_victory ? "Victory" : "Defeat" %>) </li>
        <%= render partial: "matches/team_table", locals: { appearances: match.appearances[0..4] } %>
        <li class="font-semibold mb-2">Forces of Sauron (<%= match.good_victory ? "Defeat" : "Victory" %>) </li>
        <%= render partial: "matches/team_table", locals: { appearances: match.appearances[5..9] } %>
      </ul>
    </div>

    <% if match.wc3stats_replay&.chatlog&.any? || match.wc3stats_replay&.events&.any? %>
      <div class="md:w-1/3 space-y-4">
        <% if match.wc3stats_replay&.chatlog&.any? %>
          <div>
            <strong class="block font-medium mb-2">Chat History:</strong>
            <div class="bg-gray-50 rounded-md p-3 max-h-64 overflow-y-auto text-sm font-mono">
              <% match.wc3stats_replay.chatlog.each do |msg| %>
                <div class="mb-1">
                  <span class="text-gray-500"><%= ChronicDuration.output(msg["time"], format: :short) %></span>
                  <span class="font-semibold text-blue-700"><%= match.wc3stats_replay.player_name_by_id(msg["playerId"]) %>:</span>
                  <span><%= msg["message"] %></span>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <% if match.wc3stats_replay&.events&.any? %>
          <div>
            <strong class="block font-medium mb-2">Event Log:</strong>
            <div class="bg-gray-50 rounded-md p-3 max-h-64 overflow-y-auto text-sm font-mono">
              <% match.wc3stats_replay.events.each do |event| %>
                <div class="mb-1">
                  <span class="text-gray-500"><%= ChronicDuration.output(event["time"], format: :short) %></span>
                  <span class="<%= event["eventName"] == "heroDeath" ? "text-red-600" : "text-orange-600" %>">
                    <%= event["eventName"] == "heroDeath" ? "Hero Death:" : "Base Destroyed:" %>
                  </span>
                  <span><%= match.wc3stats_replay.fix_encoding(event["args"]&.first&.gsub("\\", "")) %></span>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
