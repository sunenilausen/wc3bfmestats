<% content_for :title, @wc3stats_replay.game_name %>

<div class="w-full max-w-6xl mx-auto">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="mb-6">
    <div class="flex justify-between items-center mb-4">
      <h1 class="font-bold text-4xl"><%= @wc3stats_replay.game_name %></h1>
      <span class="px-4 py-2 text-sm font-semibold text-blue-800 bg-blue-100 rounded-full">
        ID: <%= @wc3stats_replay.wc3stats_replay_id %>
      </span>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div>
          <p class="text-sm text-gray-500">Map</p>
          <p class="text-lg font-semibold text-gray-900"><%= @wc3stats_replay.map_name %></p>
        </div>
        <div>
          <p class="text-sm text-gray-500">Duration</p>
          <p class="text-lg font-semibold text-gray-900">
            <%= ChronicDuration.output(@wc3stats_replay.game_length || 0, format: :long) %>
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-500">Played At</p>
          <p class="text-lg font-semibold text-gray-900">
            <%= @wc3stats_replay.played_at&.strftime("%b %d, %Y %H:%M") || "Unknown" %>
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-500">Replay Hash</p>
          <p class="text-sm font-mono text-gray-700 truncate"><%= @wc3stats_replay.replay_hash %></p>
        </div>
      </div>
    </div>
  </div>

  <% if @wc3stats_replay.winners.any? %>
    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-800 mb-4">Winners</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-green-200">
          <thead>
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">Player</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-green-700 uppercase tracking-wider">Team</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-green-700 uppercase tracking-wider">Unit Kills</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-green-700 uppercase tracking-wider">Hero Kills</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-green-700 uppercase tracking-wider">APM</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-green-100">
            <% @wc3stats_replay.winners.each do |player| %>
              <tr class="hover:bg-green-100">
                <td class="px-4 py-3 whitespace-nowrap font-medium text-gray-900"><%= player["name"] %></td>
                <td class="px-4 py-3 whitespace-nowrap text-gray-700"><%= player["team"] %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-900"><%= player.dig("variables", "unitKills") || "-" %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-900"><%= player.dig("variables", "heroKills") || "-" %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-700"><%= player["apm"] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <% if @wc3stats_replay.losers.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
      <h2 class="text-2xl font-bold text-red-800 mb-4">Losers</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-red-200">
          <thead>
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">Player</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-red-700 uppercase tracking-wider">Team</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-red-700 uppercase tracking-wider">Unit Kills</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-red-700 uppercase tracking-wider">Hero Kills</th>
              <th class="px-4 py-3 text-right text-xs font-medium text-red-700 uppercase tracking-wider">APM</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-red-100">
            <% @wc3stats_replay.losers.each do |player| %>
              <tr class="hover:bg-red-100">
                <td class="px-4 py-3 whitespace-nowrap font-medium text-gray-900"><%= player["name"] %></td>
                <td class="px-4 py-3 whitespace-nowrap text-gray-700"><%= player["team"] %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-900"><%= player.dig("variables", "unitKills") || "-" %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-900"><%= player.dig("variables", "heroKills") || "-" %></td>
                <td class="px-4 py-3 whitespace-nowrap text-right text-gray-700"><%= player["apm"] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>

  <div class="flex flex-wrap gap-2 mt-6">
    <% if can? :update, @wc3stats_replay %>
      <%= link_to "Edit this replay", edit_wc3stats_replay_path(@wc3stats_replay), class: "rounded-md px-4 py-2 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
    <% end %>
    <%= link_to "Back to replays", wc3stats_replays_path, class: "rounded-md px-4 py-2 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>
    <% if can? :destroy, @wc3stats_replay %>
      <%= button_to "Destroy this replay", @wc3stats_replay, method: :delete, form_class: "inline-block", class: "rounded-md px-4 py-2 text-white bg-red-600 hover:bg-red-500 font-medium cursor-pointer", data: { turbo_confirm: "Are you sure?" } %>
    <% end %>
  </div>
</div>
